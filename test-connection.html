<!DOCTYPE html>
<html>
<head>
    <title>Supabase Connection Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Supabase Connection Test</h1>
    <div id="status">Checking connection...</div>
    <button id="loginBtn" style="display:none;">Login with Email</button>
    <div id="userInfo" style="margin-top: 20px;"></div>

    <script>
        // Replace with your Supabase credentials
        const SUPABASE_URL = 'https://YOUR_PROJECT_ID.supabase.co';
        const SUPABASE_ANON_KEY = 'YOUR_ANON_KEY';

        // Initialize Supabase client
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Check connection and auth status
        async function checkConnection() {
            try {
                // Check if we can reach Supabase
                const { data: { user } } = await supabaseClient.auth.getUser();
                
                document.getElementById('status').innerHTML = 'Connected to Supabase!';
                
                if (user) {
                    document.getElementById('userInfo').innerHTML = `
                        <p>Logged in as: ${user.email}</p>
                        <button onclick="logout()">Logout</button>
                    `;
                } else {
                    document.getElementById('loginBtn').style.display = 'block';
                }
            } catch (error) {
                console.error('Connection error:', error);
                document.getElementById('status').innerHTML = `Connection failed: ${error.message}`;
            }
        }

        // Login function
        async function login() {
            const email = prompt('Enter your email:');
            if (!email) return;

            try {
                const { error } = await supabaseClient.auth.signInWithOtp({
                    email: email,
                    options: {
                        emailRedirectTo: window.location.origin
                    }
                });

                if (error) {
                    throw error;
                }

                alert('Login link sent to your email!');
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('status').innerHTML = `Login failed: ${error.message}`;
            }
        }

        // Logout function
        async function logout() {
            const { error } = await supabaseClient.auth.signOut();
            if (error) {
                console.error('Logout error:', error);
            } else {
                document.getElementById('userInfo').innerHTML = '';
                document.getElementById('loginBtn').style.display = 'block';
            }
        }

        // Handle URL hash for OAuth callbacks
        if (window.location.hash) {
            const { data, error } = await supabaseClient.auth.getSessionFromURL(window.location);
            if (error) {
                console.error('Error getting session from URL:', error);
            } else if (data?.session) {
                window.location.hash = '';
                checkConnection();
            }
        }

        // Set up event listeners
        document.getElementById('loginBtn').addEventListener('click', login);

        // Initial check
        checkConnection();
    </script>
</body>
</html>